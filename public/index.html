<!DOCTYPE html>
<html>
<head>
  <title>File Receiver</title>
  <style>
    body { font-family: Arial; text-align: center; margin-top: 50px; }
    #qr { width: 200px; margin-top: 20px; }
    #files { margin-top: 30px; }
    .file-item { margin: 10px 0; }
    a { color: blue; text-decoration: none; }
  </style>
</head>
<body>

<h1>Receiver Online</h1>
<p>Scan this QR from your mobile to send files</p>

<img id="qr" src="" alt="QR Code">

<div id="files">
  <h3>Received Files:</h3>
  <div id="fileList"></div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io();

  // Generate random session ID
  const sessionId = Math.random().toString(36).substring(2, 8);

  // QR code for mobile
  const backendURL = window.location.origin; 
  const qrData = encodeURIComponent(`${backendURL}/sender.html?room=${sessionId}`);
  document.getElementById("qr").src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${qrData}`;

  // Join session room
  socket.emit("join", sessionId);

  // Listen for new files
  socket.on("new-files", files => {
    const fileList = document.getElementById("fileList");
    files.forEach(file => {
      const div = document.createElement("div");
      div.className = "file-item";
      const link = document.createElement("a");
      link.href = `/uploads/${file}`;
      link.download = file;
      link.innerText = file;
      div.appendChild(link);
      fileList.appendChild(div);
    });
  });
</script>

</body>
</html>
