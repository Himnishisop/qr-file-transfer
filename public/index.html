<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Receiver</title>
<script src="/socket.io/socket.io.js"></script>

<style>
body {
  background:#000;
  color:#fff;
  font-family:sans-serif;
  overflow:hidden;
}
#cart {
  position:fixed;
  bottom:-200px;
  left:50%;
  transform:translateX(-50%);
  width:300px;
  height:180px;
  background:#22c55e;
  border-radius:25px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  font-size:18px;
  transition:.8s cubic-bezier(.2,1,.2,1);
}
#cart.show {
  bottom:40%;
}
#progress {
  width:80%;
  height:8px;
  background:#000;
  margin-top:10px;
}
#bar {
  height:100%;
  width:0%;
  background:#fff;
}
button {
  margin-top:12px;
  padding:10px 20px;
  border:none;
  border-radius:12px;
  background:#000;
  color:#fff;
  display:none;
}
</style>
</head>

<body>
<h2>ðŸ§  Receiver Online</h2>

<div id="cart">
  <div id="title"></div>
  <div id="progress"><div id="bar"></div></div>
  <button id="download">Download</button>
</div>

<script>
const socket = io();
const cart = document.getElementById("cart");
const bar = document.getElementById("bar");
const title = document.getElementById("title");
const btn = document.getElementById("download");

let chunks = [];
let received = 0;
let fileName = "";
let fileSize = 0;

socket.on("cart-appear", meta => {
  fileName = meta.name;
  fileSize = meta.size;
  title.innerText = "ðŸ“¦ " + fileName;
  cart.classList.add("show");
});

socket.on("file-chunk", chunk => {
  chunks.push(chunk.data);
  received += chunk.data.byteLength;
  bar.style.width = ((received / fileSize) * 100) + "%";
});

socket.on("file-done", () => {
  btn.style.display = "block";
});

btn.onclick = () => {
  const blob = new Blob(chunks);
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = fileName;
  a.click();
};
</script>
</body>
</html>
