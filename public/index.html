<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Receiver</title>
<script src="/socket.io/socket.io.js"></script>
<style>
body{
  background:#050505; color:#fff;
  font-family:system-ui; text-align:center;
}
.file{
  margin:16px auto;
  padding:16px;
  width:80%;
  max-width:420px;
  border-radius:16px;
  background:linear-gradient(45deg,#ff0055,#00ffff);
  color:#000;
  animation:pop .5s ease;
}
.bar{
  height:10px;
  background:#222;
  border-radius:10px;
  overflow:hidden;
  margin-top:10px;
}
.fill{
  height:100%;
  width:0%;
  background:#000;
  transition:width .2s;
}
@keyframes pop{
  from{transform:scale(.3);opacity:0}
  to{transform:scale(1);opacity:1}
}
</style>
</head>
<body>

<h1>ðŸ§  Telekinesis Receiver</h1>
<div id="files"></div>

<script>
const socket = io();
socket.emit("join-room","room1");

const filesDiv = document.getElementById("files");
const fileMap = {};

socket.on("file-init", files => {
  files.forEach(name => {
    const box = document.createElement("div");
    box.className = "file";
    box.innerHTML = `
      <b>${name}</b>
      <div class="bar"><div class="fill"></div></div>
    `;
    filesDiv.appendChild(box);
    fileMap[name] = box.querySelector(".fill");
  });
});

socket.on("file-progress", data => {
  const percent = Math.floor((data.uploaded / data.total) * 100);
  if (fileMap[data.fileName]) {
    fileMap[data.fileName].style.width = percent + "%";
  }
});

socket.on("file-complete", name => {
  const a = document.createElement("a");
  a.href = "/uploads/" + name;
  a.download = "";
  document.body.appendChild(a);
  a.click();
  a.remove();
});
</script>
</body>
</html>
