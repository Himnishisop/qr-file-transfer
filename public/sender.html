<!DOCTYPE html>
<html>
<head>
  <title>Send File</title>
  <script src="/socket.io/socket.io.js"></script>
</head>
<body>
  <h2>Send File (up to 500MB)</h2>

  <input type="file" id="files">
  <br><br>
  <button onclick="send()">Send</button>
  <p id="msg"></p>

<script>
const socket = io();
const room = "room1";
socket.emit("join-room", room);

async function send() {
  const file = document.getElementById("files").files[0];
  if (!file) return alert("Select a file");

  const CHUNK_SIZE = 5 * 1024 * 1024; // 5MB
  const totalChunks = Math.ceil(file.size / CHUNK_SIZE);

  document.getElementById("msg").innerText =
    `Uploading 0 / ${totalChunks}`;

  for (let i = 0; i < totalChunks; i++) {
    const chunk = file.slice(
      i * CHUNK_SIZE,
      (i + 1) * CHUNK_SIZE
    );

    const fd = new FormData();
    fd.append("chunk", chunk);
    fd.append("fileName", file.name);
    fd.append("chunkIndex", i);
    fd.append("totalChunks", totalChunks);
    fd.append("room", room);

    await fetch("/upload-chunk", {
      method: "POST",
      body: fd
    });

    document.getElementById("msg").innerText =
      `Uploading ${i + 1} / ${totalChunks}`;
  }

  document.getElementById("msg").innerText =
    "Upload complete âœ…";
}
</script>
</body>
</html>
